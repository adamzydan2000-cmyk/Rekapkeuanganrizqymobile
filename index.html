<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rizqy Mobile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Quicksand', sans-serif; background: #4f46e5; margin: 0; padding-bottom: 90px; }
        .tab-content { display: none; padding: 15px; }
        .tab-content.active { display: block !important; }
        .card { background: white; border-radius: 1rem; padding: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 15px; position: relative; }
        .input-box { width: 100%; border: 2px solid #e2e8f0; border-radius: 0.5rem; padding: 10px; font-size: 14px; margin-bottom: 10px; text-align: center; outline: none; }
        
        #navbar-bottom { position: fixed; bottom: 0; left: 0; right: 0; background: white; display: flex; height: 75px; border-top: 1px solid #e2e8f0; z-index: 99999; }
        .nav-btn { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; border: none; background: transparent; }
        .nav-btn span { font-size: 10px; font-weight: 800; color: #94a3b8; text-transform: uppercase; margin-top: 4px; }
        .nav-btn.active-tab span { color: #4f46e5; }
        
        .btn-main { background: #4f46e5; color: white; width: 100%; padding: 14px; border-radius: 0.75rem; font-weight: bold; cursor: pointer; border: none; }
        .grid-report { display: grid; grid-template-cols: 1.2fr 1fr 1fr 0.5fr; gap: 8px; align-items: center; margin-bottom: 8px; }
        .btn-del { position: absolute; top: 10px; right: 10px; color: #ef4444; font-weight: bold; font-size: 18px; }
    </style>
</head>
<body>

    <div class="text-center text-white mt-4 mb-2">
        <h1 class="text-xl font-bold italic">RIZQY MOBILE</h1>
        <p id="sub-title" class="text-[10px] uppercase text-indigo-200">Rekap Harian</p>
    </div>

    <section id="tab-rekap" class="tab-content active">
        <div class="card">
            <select id="uIn" class="input-box font-bold text-indigo-600">
                <option>Adam</option><option>Mas Rifai</option><option>Mas Fajar</option><option>Mas Satria</option><option>Mas Ali</option>
            </select>
            <div class="grid grid-cols-2 gap-2">
                <select id="tIn" class="input-box" onchange="logicForm()">
                    <option value="HP">üì± Jual HP</option><option value="ACC">üéß Aksesoris</option>
                </select>
                <select id="bIn" class="input-box">
                    <option>Oppo</option><option>Realme</option><option>Vivo</option><option>Samsung</option><option>Xiaomi</option><option>Infinix</option><option>Nokia</option><option>Other</option>
                </select>
            </div>
            <div id="divHP">
                <input type="text" id="namaHP" class="input-box" placeholder="Tipe HP">
                <label class="flex items-center gap-2 mb-3 text-xs font-bold text-indigo-500"><input type="checkbox" id="cekAcc" onchange="logicForm()"> + Aksesoris?</label>
            </div>
            <div id="divAcc" style="display:none;" class="bg-gray-50 p-3 rounded-lg border-2 border-dashed mb-3">
                <div id="accCont"><div class="grid grid-cols-3 gap-2 mb-2"><input type="number" class="akd input-box mb-0" placeholder="Kd"><input type="text" class="anm input-box mb-0 col-span-2" placeholder="Barang"></div></div>
                <button onclick="tambahAcc()" class="text-[10px] font-bold text-indigo-600 w-full">+ Tambah Baris</button>
            </div>
            <div class="grid grid-cols-2 gap-2">
                <select id="pay1" class="input-box"><option>Cash</option><option>Debit</option><option>Admin Syalsa</option><option>Admin Ika</option></select>
                <input type="number" id="nom1" class="input-box" placeholder="Nominal">
            </div>
            <label class="flex items-center gap-2 mb-3 text-[10px] font-bold text-indigo-500"><input type="checkbox" id="cekSplit" onchange="logicForm()"> SPLIT BAYAR</label>
            <div id="divSplit" style="display:none;" class="grid grid-cols-2 gap-2">
                <select id="pay2" class="input-box"><option>Debit</option><option>Cash</option><option>Admin Syalsa</option><option>Admin Ika</option></select>
                <input type="number" id="nom2" class="input-box" placeholder="Nominal 2">
            </div>
            <button onclick="simpanRekap()" class="btn-main">SIMPAN TRANSAKSI</button>
            
            <button onclick="downloadDB()" class="w-full bg-gray-800 text-white text-[10px] py-3 rounded-lg font-bold mt-4 shadow-inner">
                ‚¨áÔ∏è DOWNLOAD BACKUP DATA (JSON)
            </button>
        </div>
        <div id="rekapList"></div>
    </section>

    <section id="tab-out" class="tab-content">
        <div class="card">
            <input type="text" id="oKet" class="input-box" placeholder="Keterangan">
            <input type="number" id="oNom" class="input-box" placeholder="Nominal">
            <button onclick="simpanOut()" class="btn-main bg-red-500">SIMPAN PENGELUARAN</button>
        </div>
        <div id="outList"></div>
    </section>

    <section id="tab-report" class="tab-content">
        <div class="card">
            <input type="date" id="repTgl" class="input-box font-bold">
            <div id="brandRows"></div>
            <div id="otherRows" class="border-t pt-4 mt-4"></div>
            <div class="border-t pt-4 mt-4">
                <div class="grid-report"><div class="text-xs font-bold text-gray-500">Aksesoris</div><input type="number" id="r-aks-n" class="input-box mb-0 p-1" oninput="hitungRep()"><input type="number" id="r-aks-t" class="input-box mb-0 p-1 bg-gray-50 font-bold" readonly><div></div></div>
                <div class="grid-report mt-2 bg-indigo-50 p-2 rounded-lg"><div class="text-[11px] font-bold text-indigo-600">ALL BRAND</div><input type="number" id="r-all-n" class="input-box mb-0 p-1" oninput="hitungRep()"><input type="number" id="r-all-t" class="input-box mb-0 p-1 bg-white font-bold" readonly><div></div></div>
            </div>
            <div class="grid grid-cols-2 gap-3 border-t pt-4 mt-4">
                <div><p class="text-[10px] font-bold">Walk In</p><input type="number" id="r-wi-n" class="input-box" oninput="hitungRep()"></div>
                <div><p class="text-[10px] font-bold">Total WI</p><input type="number" id="r-wi-t" class="input-box bg-gray-50 font-bold" readonly></div>
                <input type="number" id="r-tr-n" class="input-box" placeholder="Transk" oninput="hitungRep()">
                <input type="text" id="r-tr-p" class="input-box bg-gray-50 font-bold" readonly placeholder="%">
            </div>
            <div class="bg-green-50 p-3 rounded-lg mt-4 border border-green-100">
                <input type="number" id="r-oms-h" class="input-box" placeholder="Omset Hari Ini" oninput="hitungRep()">
                <div class="grid grid-cols-2 gap-2">
                    <input type="number" id="r-bca" class="input-box" placeholder="BCA" oninput="hitungRep()">
                    <input type="number" id="r-adm" class="input-box" placeholder="Admin" oninput="hitungRep()">
                </div>
                <div class="text-[11px] font-bold text-indigo-600 text-center mb-2" id="vDeb">Total Debit: 0</div>
                <div class="grid grid-cols-2 gap-2 text-center">
                    <div><p class="text-[9px] font-bold uppercase">Tunai</p><input type="text" id="r-tunai" class="input-box bg-white" readonly></div>
                    <div><p class="text-[9px] font-bold uppercase text-red-500">Out</p><input type="text" id="r-out" class="input-box bg-red-50" readonly></div>
                </div>
                <input type="text" id="r-sisa" class="input-box bg-white text-lg font-bold text-green-600" readonly placeholder="Sisa Tunai">
            </div>
            <div class="bg-orange-50 p-3 rounded-lg mt-4 border border-orange-100">
                <p class="text-[10px] font-bold text-orange-700 mb-1">AKUMULASI OMSET BULANAN</p>
                <input type="number" id="r-oms-bln-in" class="input-box" oninput="manualOms()">
                <input type="text" id="r-oms-bln-vi" class="input-box bg-white font-bold" readonly>
            </div>
            <button onclick="doPrev()" class="btn-main mt-4">PREVIEW LAPORAN</button>
            <div id="boxPrev" class="hidden mt-4 p-3 bg-gray-100 rounded text-[11px] font-mono whitespace-pre-wrap border border-dashed"></div>
            <button onclick="doCopy()" class="btn-main bg-emerald-600 mt-2">SALIN LAPORAN</button>
            <button onclick="resetData('hari')" class="btn-main bg-orange-500 mt-2 text-[11px]">RESET DATA HARIAN</button>
        </div>
    </section>

    <nav id="navbar-bottom">
        <button class="nav-btn active-tab" onclick="switchTab('tab-rekap', this, 'Rekap Harian')">
            <p class="text-xl">üìù</p><span>Rekap</span>
        </button>
        <button class="nav-btn" onclick="switchTab('tab-out', this, 'Pengeluaran')">
            <p class="text-xl">üì§</p><span>Out</span>
        </button>
        <button class="nav-btn" onclick="switchTab('tab-report', this, 'Laporan Grup WA')">
            <p class="text-xl">üìä</p><span>Report</span>
        </button>
    </nav>

    <script>
        const BRANDS = [{id:'op',n:'Oppo',t:70},{id:'rm',n:'Realme',t:50},{id:'vv',n:'Vivo',t:20},{id:'ss',n:'Samsung',t:100},{id:'xi',n:'Xiaomi',t:45},{id:'if',n:'Infinix',t:30}];
        const OTHS = [{id:'nk',n:'Nokia'},{id:'ot',n:'Other'},{id:'sc',n:'HP Second'},{id:'sp',n:'Sepeda'}];
        let save = JSON.parse(localStorage.getItem('rizqy_save_v12')) || {oms:0, aks:0, wi:0, allb:0};
        let isEdit = false;

        const fmt = (n) => new Intl.NumberFormat('id-ID').format(n);
        const getV = (id) => parseInt(document.getElementById(id).value || 0);

        function switchTab(id, el, title) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active-tab'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active-tab');
            document.getElementById('sub-title').innerText = title;
            if(id === 'tab-report') hitungRep();
            window.scrollTo(0,0);
        }

        function logicForm() {
            const tipe = document.getElementById('tIn').value;
            document.getElementById('bIn').style.display = (tipe === 'HP' ? 'block' : 'none');
            document.getElementById('divHP').style.display = (tipe === 'HP' ? 'block' : 'none');
            document.getElementById('divAcc').style.display = (tipe === 'ACC' || document.getElementById('cekAcc').checked ? 'block' : 'none');
            document.getElementById('divSplit').style.display = (document.getElementById('cekSplit').checked ? 'grid' : 'none');
        }

        function tambahAcc() {
            const d = document.createElement('div'); d.className = 'grid grid-cols-3 gap-2 mb-2';
            d.innerHTML = `<input type="number" class="akd input-box mb-0" placeholder="Kd"><input type="text" class="anm input-box mb-0 col-span-2" placeholder="Barang">`;
            document.getElementById('accCont').appendChild(d);
        }

        function simpanRekap() {
            const total = getV('nom1') + getV('nom2');
            if(total <= 0) return alert("Nominal Kosong");
            const list = JSON.parse(localStorage.getItem('rizqy_rekap_list')) || [];
            list.push({ u: document.getElementById('uIn').value, b: document.getElementById('tIn').value === 'ACC' ? 'Aksesoris' : document.getElementById('bIn').value, i: document.getElementById('tIn').value === 'HP' ? document.getElementById('namaHP').value : 'Aksesoris', v: total });
            localStorage.setItem('rizqy_rekap_list', JSON.stringify(list));
            document.getElementById('namaHP').value = ""; document.getElementById('nom1').value = ""; document.getElementById('nom2').value = "";
            document.getElementById('cekAcc').checked = false; document.getElementById('cekSplit').checked = false;
            document.getElementById('accCont').innerHTML = `<div class="grid grid-cols-3 gap-2 mb-2"><input type="number" class="akd input-box mb-0" placeholder="Kd"><input type="text" class="anm input-box mb-0 col-span-2" placeholder="Barang"></div>`;
            logicForm(); alert("Tersimpan!"); tampilRekap();
        }

        function tampilRekap() {
            const list = JSON.parse(localStorage.getItem('rizqy_rekap_list')) || [];
            document.getElementById('rekapList').innerHTML = list.map((x, i) => `<div class="card border-l-4 border-indigo-500 py-2"><button onclick="delR(${i})" class="btn-del">‚úï</button><p class="text-[9px] font-bold text-indigo-400 uppercase">${x.u} | ${x.b}</p><p class="text-[11px] font-bold">${x.i}</p><p class="text-[10px] text-green-600 font-bold">Rp ${fmt(x.v)}</p></div>`).reverse().join('');
        }
        function delR(i) { if(confirm("Hapus?")) { let list = JSON.parse(localStorage.getItem('rizqy_rekap_list')); list.splice(i,1); localStorage.setItem('rizqy_rekap_list', JSON.stringify(list)); tampilRekap(); } }

        function simpanOut() {
            const list = JSON.parse(localStorage.getItem('rizqy_out_list')) || [];
            list.push({ n: document.getElementById('oKet').value, v: getV('oNom') });
            localStorage.setItem('rizqy_out_list', JSON.stringify(list));
            document.getElementById('oKet').value = ""; document.getElementById('oNom').value = "";
            tampilOut();
        }
        function tampilOut() {
            const list = JSON.parse(localStorage.getItem('rizqy_out_list')) || [];
            document.getElementById('outList').innerHTML = list.map((x, i) => `<div class="card border-l-4 border-red-500 py-2"><button onclick="delO(${i})" class="btn-del">‚úï</button><p class="text-[11px] font-bold">${x.n}</p><p class="text-red-500 font-bold text-xs">Rp ${fmt(x.v)}</p></div>`).reverse().join('');
        }
        function delO(i) { if(confirm("Hapus?")) { let list = JSON.parse(localStorage.getItem('rizqy_out_list')); list.splice(i,1); localStorage.setItem('rizqy_out_list', JSON.stringify(list)); tampilOut(); } }

        function hitungRep() {
            BRANDS.forEach(b => document.getElementById(b.id+'-t').value = (save[b.id]||0) + getV(b.id+'-n'));
            OTHS.forEach(o => document.getElementById(o.id+'-t').value = (save[o.id]||0) + getV(o.id+'-n'));
            document.getElementById('r-aks-t').value = (save.aks||0) + getV('r-aks-n');
            document.getElementById('r-all-t').value = (save.allb||0) + getV('r-all-n');
            document.getElementById('r-wi-t').value = (save.wi||0) + getV('r-wi-n');
            document.getElementById('r-tr-p').value = getV('r-wi-n') > 0 ? Math.round((getV('r-tr-n')/getV('r-wi-n'))*100)+"%" : "0%";
            const deb = getV('r-bca') + getV('r-adm');
            document.getElementById('vDeb').innerText = "Total Debit: Rp " + fmt(deb);
            if(!isEdit) {
                const tot = (save.oms||0) + getV('r-oms-h');
                document.getElementById('r-oms-bln-in').value = tot;
                document.getElementById('r-oms-bln-vi').value = fmt(tot);
            }
            const oVal = (JSON.parse(localStorage.getItem('rizqy_out_list'))||[]).reduce((a,b)=>a+b.v, 0);
            const tunai = getV('r-oms-h') - deb;
            document.getElementById('r-tunai').value = fmt(tunai);
            document.getElementById('r-out').value = fmt(oVal);
            document.getElementById('r-sisa').value = fmt(tunai - oVal);
        }

        function initRep() {
            document.getElementById('repTgl').value = new Date().toISOString().slice(0,10);
            document.getElementById('brandRows').innerHTML = BRANDS.map(b => `<div class="grid-report"><div class="text-xs font-bold text-gray-500">${b.n}</div><input type="number" id="${b.id}-n" class="input-box mb-0 p-1" oninput="hitungRep()"><input type="number" id="${b.id}-t" class="input-box mb-0 p-1 bg-gray-50 font-bold" value="${save[b.id]||0}" readonly><div class="text-[10px] text-orange-500 font-bold text-center">${b.t}</div></div>`).join('');
            document.getElementById('otherRows').innerHTML = OTHS.map(o => `<div class="grid-report"><div class="text-xs font-bold text-gray-500">${o.n}</div><input type="number" id="${o.id}-n" class="input-box mb-0 p-1" oninput="hitungRep()"><input type="number" id="${o.id}-t" class="input-box mb-0 p-1 bg-gray-50 font-bold" value="${save[o.id]||0}" readonly><div></div></div>`).join('');
            document.getElementById('r-oms-bln-vi').value = fmt(save.oms || 0);
        }

        function doPrev() {
            const g = (id) => document.getElementById(id).value || "0";
            let s = `Sell out toko GKB ${new Date(g('repTgl')).toLocaleDateString('id-ID',{day:'numeric',month:'long',year:'numeric'})}\n\nFokuskan brand\n`;
            BRANDS.forEach((b,i) => { s += `${b.n} : ${g(b.id+'-n')}.${g(b.id+'-t')}.${b.t} (${Math.round((g(b.id+'-t')/b.t)*100)||0}%)\n`; if(i===2) s+="\n"; });
            s += `Nokia : ${g('nk-n')}.${g('nk-t')}\n\nOther : ${g('ot-n')}.${g('ot-t')}\nHP Second : ${g('sc-n')}.${g('sc-t')}\n\nSepeda : ${g('sp-n')}.${g('sp-t')}\n`;
            s += `Aksesoris : ${g('r-aks-n')}.${g('r-aks-t')}\nAll Brand : ${g('r-all-n')}.${g('r-all-t')}\n\nWalk in : ${g('r-wi-n')}(${g('r-wi-t')})\nTransaksi : ${g('r-tr-n')}(${g('r-tr-p')})\n\n`;
            const deb = getV('r-bca') + getV('r-adm');
            const oVal = (JSON.parse(localStorage.getItem('rizqy_out_list'))||[]).reduce((a,b)=>a+b.v, 0);
            s += `*tunai : ${fmt(getV('r-oms-h')-deb)}\n\n*debit : ${fmt(deb)}\n- bca ${fmt(getV('r-bca'))}\n- bca admin ${fmt(getV('r-adm'))}\n\n*pengeluaran : ${fmt(oVal)}\n*sisa tunai : ${fmt(getV('r-oms-h')-deb-oVal)}\n\nPencapaian omset : ${fmt(getV('r-oms-bln-in'))}`;
            document.getElementById('boxPrev').innerText = s; document.getElementById('boxPrev').classList.remove('hidden');
        }

        function doCopy() { navigator.clipboard.writeText(document.getElementById('boxPrev').innerText).then(()=>alert("Disalin!")); }

        function downloadDB() {
            const data = JSON.stringify(localStorage);
            const blob = new Blob([data], {type: 'application/json'});
            const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
            a.download = `Rizqy_Backup_${new Date().toISOString().slice(0,10)}.json`; a.click();
        }

        function resetData(mode) {
            if(confirm("Reset data?")) {
                BRANDS.forEach(b => save[b.id] = getV(b.id + '-t'));
                OTHS.forEach(o => save[o.id] = getV(o.id + '-t'));
                save.aks = getV('r-aks-t'); save.wi = getV('r-wi-t'); save.allb = getV('r-all-t'); save.oms = getV('r-oms-bln-in');
                localStorage.setItem('rizqy_save_v12', JSON.stringify(save));
                localStorage.removeItem('rizqy_rekap_list'); localStorage.removeItem('rizqy_out_list');
                location.reload();
            }
        }

        window.onload = () => { tampilRekap(); tampilOut(); initRep(); logicForm(); };
    </script>
</body>
                </html>
    
