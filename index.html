<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RIZQY MOBILE</title>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        body { font-family: sans-serif; background: #121212; margin: 0; padding-bottom: 90px; color: #e0e0e0; }
        
        .header { background: #4f46e5; color: white; text-align: center; padding: 15px; position: sticky; top: 0; z-index: 100; }
        .header h1 { margin: 0; font-size: 18px; letter-spacing: 1px; }
        #navbar { position: fixed; bottom: 0; left: 0; width: 100%; background: #1e1e1e; display: flex; border-top: 1px solid #333; height: 70px; z-index: 999; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 11px; color: #888; border: none; background: none; }
        .nav-item.active { color: #818cf8; font-weight: bold; }
        .nav-item span { font-size: 22px; margin-bottom: 4px; }
        .content { display: none; padding: 15px; }
        .content.active { display: block; }
        .card { background: #1e1e1e; border-radius: 12px; padding: 15px; border: 1px solid #333; margin-bottom: 10px; }
        input, select { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #444; border-radius: 8px; font-size: 14px; background: #252525; color: white; text-align: center; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 8px; font-weight: bold; font-size: 14px; cursor: pointer; margin-bottom: 10px; color: white; }
        .btn-blue { background: #4f46e5; }
        .btn-green { background: #10b981; }
        .btn-red { background: #ef4444; }
        .btn-dark { background: #2d3748; }
        .rep-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
        .rep-label { flex: 1.5; font-size: 12px; font-weight: bold; color: #bbb; }
        .rep-input { flex: 1; margin-bottom: 0 !important; padding: 8px !important; }
        .rep-total { flex: 1; background: #2d2d2d !important; font-weight: bold; border-color: #444; }
        .rep-target { flex: 0.6; font-size: 11px; text-align: center; color: #f59e0b; font-weight: bold; }
        .list-box { background: #252525; padding: 12px; border-radius: 8px; margin-bottom: 8px; border-left: 5px solid #4f46e5; position: relative; border: 1px solid #333; font-size: 13px; }
        .del-x { position: absolute; right: 12px; top: 12px; color: #ef4444; font-weight: bold; font-size: 18px; padding: 5px; }
        .flex { display: flex; gap: 8px; }
        .hidden { display: none; }
        .btn-del-row { background: #ef4444; border: none; color: white; border-radius: 5px; padding: 0 10px; font-weight: bold; cursor: pointer; }
        .editable-mode { background: #2d3748 !important; border: 1px solid #818cf8 !important; }
    </style>
</head>
<body>
    <div class="header">
        <h1>RIZQY MOBILE</h1>
    </div>
    <div id="tab-rekap" class="content active">
        <div class="card">
            <select id="uIn" style="color: #818cf8; font-weight: bold;">
                <option>Adam</option><option>Mas Rifai</option><option>Mas Fajar</option><option>Mas Satria</option><option>Mas Ali</option>
            </select>
            <div class="flex">
                <select id="tIn" style="flex:1" onchange="logicForm()"><option value="HP">üì± HP</option><option value="ACC">üéß ACC</option></select>
                <select id="bIn" style="flex:1"><option>Oppo</option><option>Realme</option><option>Vivo</option><option>Samsung</option><option>Xiaomi</option><option>Infinix</option><option>Nokia</option><option>Other</option></select>
            </div>
            
            <div id="divHP">
                <input type="text" id="namaHP" placeholder="Tipe HP">
                <label style="font-size: 12px; display: block; margin-bottom: 10px; color:#bbb;"><input type="checkbox" id="cekAcc" onchange="logicForm()"> + Aksesoris?</label>
            </div>
            <div id="divAcc" class="hidden" style="background: #252525; padding: 10px; border: 1px dashed #4f46e5; border-radius: 8px; margin-bottom: 10px;">
                <div id="accCont">
                    <div class="flex acc-row" style="margin-bottom:5px;">
                        <input type="number" class="akode" placeholder="Kd (4)" oninput="if(this.value.length > 4) this.value = this.value.slice(0,4);" style="flex:0.4">
                        <input type="text" class="anama" placeholder="Nama Barang" style="flex:1">
                    </div>
                </div>
                <button onclick="tambahBaris()" type="button" style="width:100%; font-size:10px; padding:8px; background:none; border:1px solid #444; color:#aaa; border-radius:5px;">+ TAMBAH BARIS</button>
            </div>
            <input type="number" id="nom1" placeholder="Nominal Total Rp">
            <button onclick="saveRekap()" class="btn btn-blue">SIMPAN TRANSAKSI</button>
            <button onclick="exportExcel()" class="btn btn-dark" style="font-size: 11px;">üìä DOWNLOAD EXCEL</button>
        </div>
        <div id="listRekap"></div>
    </div>
    <div id="tab-out" class="content">
        <div class="card">
            <input type="text" id="oKet" placeholder="Keterangan">
            <input type="number" id="oNom" placeholder="Nominal Rp">
            <button onclick="saveOut()" class="btn btn-red">SIMPAN PENGELUARAN</button>
        </div>
        <div id="listOut"></div>
    </div>
    <div id="tab-report" class="content">
        <div class="card">
            <h3 style="text-align: center; margin-top: 0; color: #818cf8; font-size: 16px;">REKAP HARIAN</h3>
            <input type="date" id="tglRep" style="font-weight: bold;">
            
            <label style="display: block; text-align: center; font-size: 11px; margin-bottom: 15px; color: #f59e0b;">
                <input type="checkbox" id="modeEdit" onchange="toggleEditBulanan()"> üîì AKTIFKAN EDIT BULANAN
            </label>
            <div id="brandArea"></div>
            <div id="othArea" style="border-top: 1px solid #333; padding-top: 10px; margin-top: 10px;"></div>
            
            <div class="rep-row" style="margin-top:10px;">
                <div class="rep-label">Aksesoris</div>
                <input type="number" id="r-aks-n" class="rep-input" oninput="hitung()">
                <input type="number" id="r-aks-t" class="rep-input rep-total" readonly oninput="manualUpdate('aks', this.value)">
                <div class="rep-target"></div>
            </div>
            
            <div class="rep-row" style="background:#1e293b; padding:5px; border-radius:5px;">
                <div class="rep-label" style="color:#818cf8;">ALL BRAND</div>
                <input type="number" id="r-all-n" class="rep-input rep-total" style="background:#111 !important;" readonly placeholder="Auto">
                <input type="number" id="r-all-t" class="rep-input rep-total" readonly>
                <div class="rep-target"></div>
            </div>
            <div class="flex" style="margin-top:10px;">
                <div style="flex:1"><small>Walk In</small><input type="number" id="wi-n" oninput="hitung()"></div>
                <div style="flex:1"><small>Total WI</small><input type="number" id="wi-t" class="rep-total" readonly oninput="manualUpdate('wi', this.value)"></div>
            </div>
            <div class="flex">
                <div style="flex:1"><small>Transaksi</small><input type="number" id="tr-n" oninput="hitung()"></div>
                <div style="flex:1"><small>% Trx</small><input type="text" id="tr-p" class="rep-total" readonly></div>
            </div>
            <div style="background: #064e3b; padding: 12px; border-radius: 8px; border: 1px solid #059669; margin-top: 15px;">
                <small>OMSET HARI INI</small>
                <input type="number" id="omsH" oninput="hitung()">
                <div class="flex">
                    <div style="flex:1"><small>BCA</small><input type="number" id="bca" oninput="hitung()"></div>
                    <div style="flex:1"><small>ADM</small><input type="number" id="adm" oninput="hitung()"></div>
                </div>
                <div id="txtDeb" style="text-align:center; font-weight:bold; font-size:12px; margin:5px 0;">Debit: 0</div>
                <div class="flex">
                    <div style="flex:1; text-align:center;"><small>TUNAI</small><input type="text" id="vTunai" readonly></div>
                    <div style="flex:1; text-align:center;"><small style="color:#f87171;">OUT</small><input type="text" id="vOut" readonly style="color:#f87171;"></div>
                </div>
                <input type="text" id="vSisa" readonly style="font-size:18px; font-weight:bold; color:#34d399; margin-top:5px; border:1px solid #34d399;" placeholder="SISA TUNAI">
            </div>
            <div style="background: #431407; padding: 12px; border-radius: 8px; border: 1px solid #9a3412; margin-top: 10px;">
                <small>OMSET BULANAN</small>
                <div class="flex">
                    <input type="number" id="omsB-in" oninput="hitung()" class="rep-input" placeholder="Base Omset">
                    <input type="number" id="omsB-total" class="rep-input rep-total" readonly oninput="manualUpdateOmsTotal(this.value)" placeholder="Total Omset">
                </div>
            </div>
            <button onclick="preview()" class="btn btn-blue" style="margin-top: 15px;">PREVIEW LAPORAN</button>
            <div id="boxPrev" class="hidden" style="background:#fff; color:#000; padding:10px; font-family:monospace; font-size:11px; margin-top:10px; white-space:pre-wrap;"></div>
            <button onclick="copyWA()" class="btn btn-green">SALIN WA</button>
            
            <div class="flex" style="margin-top: 20px;">
                <button onclick="resetData('hari')" class="btn btn-dark" style="flex:1; font-size:11px;">RESET HARI</button>
                <button onclick="resetData('bulan')" class="btn btn-red" style="flex:1; font-size:11px;">RESET BULAN</button>
            </div>
        </div>
    </div>
    <div id="navbar">
        <button class="nav-item active" onclick="tab('tab-rekap', this)"><span>üìù</span>Rekap</button>
        <button class="nav-item" onclick="tab('tab-out', this)"><span>üì§</span>Out</button>
        <button class="nav-item" onclick="tab('tab-report', this)"><span>üìä</span>Report</button>
    </div>
    <script>
        const B = [{id:'op',n:'Oppo',t:70},{id:'rm',n:'Realme',t:50},{id:'vv',n:'Vivo',t:20},{id:'ss',n:'Samsung',t:100},{id:'xi',n:'Xiaomi',t:45},{id:'if',n:'Infinix',t:30}];
        const O = [{id:'nk',n:'Nokia'},{id:'ot',n:'Other'},{id:'sc',n:'Second'},{id:'sp',n:'Sepeda'}];
        let db = JSON.parse(localStorage.getItem('RZ_FINAL_DB')) || {oms:0, aks:0, wi:0, allb:0};
        function tab(id, el) {
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
            if(id === 'tab-report') renderReport();
            window.scrollTo(0,0);
        }
        function logicForm() {
            const t = document.getElementById('tIn').value;
            document.getElementById('divHP').style.display = t === 'HP' ? 'block' : 'none';
            document.getElementById('bIn').style.display = t === 'HP' ? 'block' : 'none';
            document.getElementById('divAcc').classList.toggle('hidden', t !== 'ACC' && !document.getElementById('cekAcc').checked);
        }
        function tambahBaris() {
            const row = document.createElement('div');
            row.className = 'flex acc-row'; row.style.marginTop = '5px';
            row.innerHTML = `<input type="number" class="akode" placeholder="Kd (4)" oninput="if(this.value.length > 4) this.value = this.value.slice(0,4);" style="flex:0.4"><input type="text" class="anama" placeholder="Nama Barang" style="flex:1"><button class="btn-del-row" onclick="this.parentElement.remove()">‚úï</button>`;
            document.getElementById('accCont').appendChild(row);
        }
        function toggleEditBulanan() {
            const isEdit = document.getElementById('modeEdit').checked;
            document.querySelectorAll('.rep-total').forEach(el => {
                if (el.id !== 'r-all-t' && el.id !== 'tr-p') {
                    el.readOnly = !isEdit;
                    el.classList.toggle('editable-mode', isEdit);
                }
            });
            document.getElementById('omsB-in').readOnly = !isEdit;
            document.getElementById('omsB-in').classList.toggle('editable-mode', isEdit);
        }
        function manualUpdate(id, val) {
            const harian = parseInt(document.getElementById(id + (id==='aks'||id==='wi'?'':'-n'))?.value || 0);
            db[id] = parseInt(val || 0) - harian;
            localStorage.setItem('RZ_FINAL_DB', JSON.stringify(db));
        }
        function manualUpdateOmsTotal(val) {
            const harianOms = parseInt(document.getElementById('omsH').value || 0);
            db.oms = parseInt(val || 0) - harianOms;
            localStorage.setItem('RZ_FINAL_DB', JSON.stringify(db));
        }
        function saveRekap() {
            const v = parseInt(document.getElementById('nom1').value || 0);
            if(v <= 0) return alert("Isi nominal!");
            const kodes = document.querySelectorAll('.akode');
            const namas = document.querySelectorAll('.anama');
            let accs = [];
            namas.forEach((el, idx) => { if(el.value) accs.push(`${el.value} [${kodes[idx].value || '-'}]`); });
            let detail = document.getElementById('tIn').value === 'HP' ? document.getElementById('namaHP').value : "";
            const list = JSON.parse(localStorage.getItem('RZ_L_REKAP')) || [];
            list.push({ u: document.getElementById('uIn').value, b: document.getElementById('tIn').value === 'ACC' ? 'Aksesoris' : document.getElementById('bIn').value, i: detail + (accs.length > 0 ? (detail ? " + " : "") + accs.join(", ") : ""), v: v });
            localStorage.setItem('RZ_L_REKAP', JSON.stringify(list));
            document.getElementById('namaHP').value = ''; document.getElementById('nom1').value = '';
            document.getElementById('accCont').innerHTML = `<div class="flex acc-row" style="margin-bottom:5px;"><input type="number" class="akode" placeholder="Kd (4)" style="flex:0.4"><input type="text" class="anama" placeholder="Nama Barang" style="flex:1"></div>`;
            showRekap(); alert("Berhasil!");
        }
        function showRekap() {
            const list = JSON.parse(localStorage.getItem('RZ_L_REKAP')) || [];
            document.getElementById('listRekap').innerHTML = list.map((x,i)=>`<div class="list-box"><div class="del-x" onclick="delR(${i})">‚úï</div><b>${x.u} | ${x.b}</b><br><small>${x.i}</small><br><b style="color:#34d399;">Rp ${x.v.toLocaleString()}</b></div>`).reverse().join('');
        }
        function delR(i) { if(confirm("Hapus?")) { let list = JSON.parse(localStorage.getItem('RZ_L_REKAP')); list.splice(i,1); localStorage.setItem('RZ_L_REKAP', JSON.stringify(list)); showRekap(); } }
        function saveOut() {
            const n = document.getElementById('oKet').value; const v = parseInt(document.getElementById('oNom').value || 0);
            if(!n || v <= 0) return alert("Lengkapi data!");
            const list = JSON.parse(localStorage.getItem('RZ_L_OUT')) || [];
            list.push({n, v}); localStorage.setItem('RZ_L_OUT', JSON.stringify(list));
            document.getElementById('oKet').value = ''; document.getElementById('oNom').value = '';
            showOut(); alert("Berhasil!");
        }
        function showOut() {
            const list = JSON.parse(localStorage.getItem('RZ_L_OUT')) || [];
            document.getElementById('listOut').innerHTML = list.map((x,i)=>`<div class="list-box" style="border-left-color:red;"><div class="del-x" onclick="delO(${i})">‚úï</div><b>${x.n}</b><br><b style="color:#f87171;">Rp ${x.v.toLocaleString()}</b></div>`).reverse().join('');
        }
        function delO(i) { if(confirm("Hapus?")) { let list = JSON.parse(localStorage.getItem('RZ_L_OUT')); list.splice(i,1); localStorage.setItem('RZ_L_OUT', JSON.stringify(list)); showOut(); } }
        function renderReport() {
            document.getElementById('tglRep').value = new Date().toISOString().slice(0,10);
            document.getElementById('brandArea').innerHTML = B.map(x => `<div class="rep-row"><div class="rep-label">${x.n}</div><input type="number" id="${x.id}-n" class="rep-input" oninput="hitung()"><input type="number" id="${x.id}-t" class="rep-input rep-total" value="${db[x.id]||0}" readonly oninput="manualUpdate('${x.id}', this.value)"><div class="rep-target">${x.t}</div></div>`).join('');
            document.getElementById('othArea').innerHTML = O.map(x => `<div class="rep-row"><div class="rep-label">${x.n}</div><input type="number" id="${x.id}-n" class="rep-input" oninput="hitung()"><input type="number" id="${x.id}-t" class="rep-input rep-total" value="${db[x.id]||0}" readonly oninput="manualUpdate('${x.id}', this.value)"><div class="rep-target"></div></div>`).join('');
            document.getElementById('r-aks-t').value = db.aks || 0;
            document.getElementById('r-all-t').value = db.allb || 0;
            document.getElementById('wi-t').value = db.wi || 0;
            document.getElementById('omsB-in').value = db.oms || 0;
            toggleEditBulanan();
            hitung();
        }
        function hitung() {
            const g = (id) => parseInt(document.getElementById(id).value || 0);
            let totalAllBrandIn = 0;
            B.forEach(x => { const valN = g(x.id+'-n'); totalAllBrandIn += valN; document.getElementById(x.id+'-t').value = (db[x.id]||0) + valN; });
            document.getElementById('r-all-n').value = totalAllBrandIn;
            O.forEach(x => document.getElementById(x.id+'-t').value = (db[x.id]||0) + g(x.id+'-n'));
            document.getElementById('r-aks-t').value = (db.aks || 0) + g('r-aks-n');
            document.getElementById('r-all-t').value = (db.allb || 0) + totalAllBrandIn;
            document.getElementById('wi-t').value = (db.wi || 0) + g('wi-n');
            document.getElementById('tr-p').value = g('wi-n') > 0 ? Math.round((g('tr-n')/g('wi-n'))*100)+"%" : "0%";
            const deb = g('bca') + g('adm');
            document.getElementById('txtDeb').innerText = "Debit: Rp " + deb.toLocaleString();
            const outV = (JSON.parse(localStorage.getItem('RZ_L_OUT'))||[]).reduce((a,b)=>a+b.v, 0);
            const tunai = g('omsH') - deb;
            document.getElementById('vTunai').value = tunai.toLocaleString();
            document.getElementById('vOut').value = outV.toLocaleString();
            document.getElementById('vSisa').value = (tunai - outV).toLocaleString();
            
            // Logika Omset
            const omsBBase = document.getElementById('modeEdit').checked ? g('omsB-in') : (db.oms || 0);
            document.getElementById('omsB-total').value = omsBBase + g('omsH');
        }
        function preview() {
            const g = (id) => document.getElementById(id).value || 0;
            const format = (v) => parseInt(v).toLocaleString();
            let s = `Sell out toko GKB ${new Date(document.getElementById('tglRep').value).toLocaleDateString('id-ID',{day:'numeric',month:'long',year:'numeric'})}\n\nFokuskan brand\n`;
            B.forEach((x,i) => {
                const h = g(x.id+'-n'); const t = g(x.id+'-t');
                s += `${x.n} : ${h}.${t}.${x.t} (${Math.round((t/x.t)*100)||0}%)\n`;
                if(i === 2) s += `\n`;
            });
            s += `Nokia : ${g('nk-n')}.${g('nk-t')}\n\nOther : ${g('ot-n')}.${g('ot-t')}\nHP Second : ${g('sc-n')}.${g('sc-t')}\n\nSepeda : ${g('sp-n')}.${g('sp-t')}\n`;
            s += `Aksesoris : ${g('r-aks-n')}.${g('r-aks-t')}\nAll Brand : ${g('r-all-n')}.${g('r-all-t')}\n\n`;
            s += `Walk in : ${g('wi-n')}(${g('wi-t')})\nTransaksi : ${g('tr-n')}(${document.getElementById('tr-p').value})\n\n`;
            const deb = g('bca') + g('adm'); const outV = (JSON.parse(localStorage.getItem('RZ_L_OUT'))||[]).reduce((a,b)=>a+b.v, 0);
            s += `*tunai : ${format(g('omsH')-deb)}\n\n*debit : ${format(deb)}\n- bca ${format(g('bca'))}\n- bca admin ${format(g('adm'))}\n\n*pengeluaran : ${format(outV)}\n*sisa tunai : ${format(g('omsH')-deb-outV)}\n\nPencapaian omset : ${format(g('omsB-total'))}`;
            document.getElementById('boxPrev').innerText = s; document.getElementById('boxPrev').classList.remove('hidden');
        }
        function copyWA() { navigator.clipboard.writeText(document.getElementById('boxPrev').innerText); alert("Disalin!"); }
        function exportExcel() {
            const list = JSON.parse(localStorage.getItem('RZ_L_REKAP')) || []; if(list.length === 0) return alert("Kosong");
            let t = `User,Brand,Detail,Nominal\n`; list.forEach(x => { t += `${x.u},${x.b},"${x.i}",${x.v}\n`; });
            const blob = new Blob([t], {type:'text/csv'}); const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
            a.download = `Rekap_Rizqy_${new Date().toISOString().slice(0,10)}.csv`; a.click();
        }
        function resetData(m) {
            if(!confirm("Yakin reset " + m + "?")) return;
            if(m === 'hari') {
                const g = (id) => parseInt(document.getElementById(id).value || 0);
                B.forEach(x => db[x.id] = (db[x.id]||0) + g(x.id+'-n'));
                O.forEach(x => db[x.id] = (db[x.id]||0) + g(x.id+'-n'));
                db.aks = (db.aks||0) + g('r-aks-n'); db.wi = (db.wi||0) + g('wi-n');
                db.allb = (db.allb||0) + g('r-all-n'); db.oms = (db.oms||0) + g('omsH');
            } else { db = {oms:0, aks:0, wi:0, allb:0}; }
            localStorage.setItem('RZ_FINAL_DB', JSON.stringify(db));
            localStorage.removeItem('RZ_L_REKAP'); localStorage.removeItem('RZ_L_OUT');
            location.reload();
        }
        window.onload = () => { showRekap(); showOut(); logicForm(); };
    </script>
</body>
</html>
