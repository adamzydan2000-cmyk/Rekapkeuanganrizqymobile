<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rizqy Mobile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Quicksand', sans-serif; background: #4f46e5; margin: 0; padding-bottom: 90px; }
        .tab-content { display: none; padding: 15px; }
        .active { display: block !important; }
        .card { background: white; border-radius: 1rem; padding: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 15px; position: relative; }
        .input-box { width: 100%; border: 2px solid #e2e8f0; border-radius: 0.5rem; padding: 10px; font-size: 14px; margin-bottom: 10px; text-align: center; outline: none; }
        #nav-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; display: flex; height: 70px; border-top: 1px solid #ddd; z-index: 1000; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #94a3b8; font-size: 10px; font-weight: bold; border: none; background: none; cursor: pointer; }
        .nav-item.active-nav { color: #4f46e5; }
        .btn-blue { background: #4f46e5; color: white; width: 100%; padding: 12px; border-radius: 0.5rem; font-weight: bold; border: none; cursor: pointer; }
        .grid-report { display: grid; grid-template-cols: 1.2fr 1fr 1fr 0.5fr; gap: 8px; align-items: center; margin-bottom: 8px; }
        .btn-delete { position: absolute; top: 10px; right: 10px; background: #fee2e2; color: #ef4444; width: 25px; height: 25px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; border: 1px solid #fca5a5; cursor: pointer; }
    </style>
</head>
<body>

    <div id="rekap-page" class="tab-content active">
        <div class="text-center text-white mb-4"><h1 class="text-xl font-bold italic">RIZQY MOBILE</h1><p class="text-[10px] uppercase text-indigo-200">Rekap Harian</p></div>
        <div class="card">
            <select id="userSelect" class="input-box font-bold text-indigo-600">
                <option>Adam</option><option>Mas Rifai</option><option>Mas Fajar</option><option>Mas Satria</option><option>Mas Ali</option>
            </select>
            <div class="grid grid-cols-2 gap-2">
                <select id="tipeSelect" class="input-box font-bold" onchange="toggleForm()">
                    <option value="HP">üì± Jual HP</option><option value="ACC">üéß Aksesoris</option>
                </select>
                <select id="brandSelect" class="input-box">
                    <option>Oppo</option><option>Realme</option><option>Vivo</option><option>Samsung</option><option>Xiaomi</option><option>Infinix</option><option>Nokia</option><option>Other</option>
                </select>
            </div>
            <div id="sectionHP">
                <input type="text" id="namaHP" class="input-box" placeholder="Tipe HP">
                <label class="flex items-center gap-2 mb-3 text-xs font-bold text-indigo-500"><input type="checkbox" id="checkTambahAcc" onchange="toggleForm()"> + Tambah Aksesoris?</label>
            </div>
            <div id="sectionAcc" style="display:none;" class="bg-gray-50 p-3 rounded-lg border-2 border-dashed mb-3">
                <div id="accInputs"><div class="grid grid-cols-3 gap-2 mb-2"><input type="number" class="a-kd input-box mb-0" placeholder="Kd"><input type="text" class="a-nm input-box mb-0 col-span-2" placeholder="Barang"></div></div>
                <button onclick="addAccRow()" class="text-[10px] font-bold text-indigo-600">+ Baris</button>
            </div>
            <div class="bg-blue-50 p-3 rounded-lg mb-3">
                <div class="grid grid-cols-2 gap-2">
                    <select id="p1" class="input-box mb-0 text-xs"><option>Cash</option><option>Debit</option><option>Admin Syalsa</option><option>Admin Ika</option></select>
                    <input type="number" id="n1" class="input-box mb-0" placeholder="Nominal">
                </div>
                <label class="flex items-center gap-2 mt-2 text-[10px] font-bold text-blue-500"><input type="checkbox" id="checkSplit" onchange="toggleForm()"> SPLIT BAYAR</label>
                <div id="sectionSplit" style="display:none;" class="grid grid-cols-2 gap-2 mt-2 pt-2 border-t border-blue-200">
                    <select id="p2" class="input-box mb-0 text-xs"><option>Debit</option><option>Cash</option><option>Admin Syalsa</option><option>Admin Ika</option></select>
                    <input type="number" id="n2" class="input-box mb-0" placeholder="Nominal 2">
                </div>
            </div>
            <button onclick="saveRekap()" class="btn-blue">SIMPAN TRANSAKSI</button>
        </div>
        <div id="listRekap"></div>
    </div>

    <div id="out-page" class="tab-content">
        <div class="text-center text-white mb-4"><h1 class="text-xl font-bold italic">RIZQY MOBILE</h1><p class="text-[10px] uppercase text-indigo-200">Pengeluaran</p></div>
        <div class="card">
            <input type="text" id="oNm" class="input-box" placeholder="Keterangan">
            <input type="number" id="oV" class="input-box text-red-500 font-bold" placeholder="Nominal">
            <button onclick="saveOut()" class="btn-blue bg-red-500 uppercase">Simpan Pengeluaran</button>
        </div>
        <div id="listOut"></div>
    </div>

    <div id="report-page" class="tab-content">
        <div class="text-center text-white mb-4"><h1 class="text-xl font-bold italic">RIZQY MOBILE</h1><p class="text-[10px] uppercase text-indigo-200">Laporan Grup WA</p></div>
        <div class="card">
            <input type="date" id="wTgl" class="input-box font-bold mb-4">
            
            <div id="brandList"></div>
            <div id="otherList" class="border-t pt-4 mt-4"></div>
            
            <div class="border-t pt-4 mt-4">
                <div class="grid-report">
                    <div class="text-xs font-bold text-gray-600">Aksesoris</div>
                    <input type="number" id="aks-n" class="input-box mb-0 p-1" oninput="calc()">
                    <input type="number" id="aks-t" class="input-box mb-0 p-1 bg-gray-100 font-bold" readonly>
                    <div></div>
                </div>

                <div class="grid-report mt-2 mb-4 bg-indigo-50 p-2 rounded-lg border border-indigo-100">
                    <div class="text-[11px] font-bold text-indigo-600">ALL BRAND</div>
                    <input type="number" id="allb-n" class="input-box mb-0 p-1 border-indigo-200" oninput="calc()">
                    <input type="number" id="allb-t" class="input-box mb-0 p-1 bg-white font-bold" readonly>
                    <div></div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3 border-t pt-4">
                <div><p class="text-[10px] font-bold text-center">Walk In</p><input type="number" id="wi-n" class="input-box" oninput="calc()"></div>
                <div><p class="text-[10px] font-bold text-center">Total WI</p><input type="number" id="wi-t" class="input-box bg-gray-100 font-bold" readonly></div>
                <div><input type="number" id="tr-n" class="input-box" placeholder="Transk" oninput="calc()"></div>
                <div><input type="text" id="tr-p" class="input-box bg-gray-100 font-bold" readonly placeholder="%"></div>
                <div class="col-span-2 bg-indigo-50 p-2 rounded-lg"><p class="text-[10px] font-bold text-center text-indigo-600 mb-1 uppercase">Omset Hari Ini</p><input type="number" id="wOms" class="input-box mb-0" oninput="calc()"></div>
                <input type="number" id="wBca" class="input-box" placeholder="BCA" oninput="calc()">
                <input type="number" id="wAdm" class="input-box" placeholder="Admin" oninput="calc()">
                <div class="col-span-2 bg-blue-50 p-1 rounded border text-center font-bold text-blue-700 text-xs mb-2" id="vDeb">Total Debit: 0</div>
                <div class="text-center"><p class="text-[9px] font-bold text-gray-500">TUNAI</p><input type="text" id="wTunai" class="input-box bg-gray-50 text-[11px]" readonly></div>
                <div class="text-center"><p class="text-[9px] font-bold text-red-500">OUT</p><input type="text" id="wOut" class="input-box bg-red-50 text-[11px]" readonly></div>
                <div class="col-span-2"><p class="text-[10px] font-bold text-center text-green-600">SISA TUNAI</p><input type="text" id="wSisa" class="input-box bg-green-50 text-green-700 font-bold text-lg" readonly></div>
            </div>

            <div class="mt-4 p-2 bg-yellow-50 rounded-lg border border-yellow-200">
                <p class="text-[10px] font-bold text-yellow-700 uppercase">Pencapaian Omset (Akumulasi)</p>
                <div class="grid grid-cols-3 gap-2 items-center">
                    <input type="number" id="wOmsBlnInput" class="input-box mb-0 col-span-2" oninput="manOms()">
                    <input type="text" id="wOmsBlnView" class="input-box mb-0 bg-gray-100 font-bold text-indigo-700" readonly value="0">
                </div>
            </div>

            <button onclick="preview()" class="btn-blue mt-4">PREVIEW LAPORAN</button>
            <div class="grid grid-cols-2 gap-2 mt-2">
                <button onclick="copyText()" class="btn-blue bg-emerald-600 text-[11px]">SALIN LAPORAN</button>
                <button onclick="resetData('hari')" class="btn-blue bg-orange-500 text-[11px]">RESET HARIAN</button>
            </div>
            <button onclick="resetData('bulan')" class="btn-blue bg-red-600 mt-2 text-[11px] uppercase tracking-wider">Reset Seluruh Bulan</button>
            <div id="previewBox" class="hidden mt-4 p-3 bg-gray-100 rounded text-[11px] font-mono whitespace-pre-wrap border border-dashed text-gray-800"></div>
        </div>
    </div>

    <nav id="nav-bar">
        <button class="nav-item active-nav" onclick="goTab('rekap-page', this)"><span>üìù</span>REKAP</button>
        <button class="nav-item" onclick="goTab('out-page', this)"><span>üì§</span>OUT</button>
        <button class="nav-item" onclick="goTab('report-page', this)"><span>üìä</span>REPORT</button>
    </nav>

    <script>
        const bCf = [{id:'op',n:'Oppo',t:70},{id:'rm',n:'Realme',t:50},{id:'vv',n:'Vivo',t:20},{id:'ss',n:'Samsung',t:100},{id:'xi',n:'Xiaomi',t:45},{id:'if',n:'Infinix',t:30}];
        const oCf = [{id:'nk',n:'Nokia'},{id:'ot',n:'Other'},{id:'sc',n:'Hp Second & Demo'},{id:'sp',n:'Sepeda'}];
        let dbW = JSON.parse(localStorage.getItem('rizqy_save')) || {oms:0, aks:0, wi:0, allb:0};
        let isManualOms = false;

        const f = (n) => new Intl.NumberFormat('id-ID').format(n);
        const vn = (id) => parseInt(document.getElementById(id).value || 0);

        function goTab(id, el) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active-nav'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active-nav');
            if(id==='report-page') calc();
        }

        function toggleForm() {
            const tipe = document.getElementById('tipeSelect').value;
            document.getElementById('sectionHP').style.display = (tipe==='HP'?'block':'none');
            document.getElementById('sectionAcc').style.display = (tipe==='ACC' || (tipe==='HP' && document.getElementById('checkTambahAcc').checked)?'block':'none');
            document.getElementById('sectionSplit').style.display = (document.getElementById('checkSplit').checked?'grid':'none');
        }

        function addAccRow() {
            const div = document.createElement('div'); div.className = 'grid grid-cols-3 gap-2 mb-2';
            div.innerHTML = `<input type="number" class="a-kd input-box mb-0" placeholder="Kd"><input type="text" class="a-nm input-box mb-0 col-span-2" placeholder="Barang">`;
            document.getElementById('accInputs').appendChild(div);
        }

        function saveRekap() {
            let total = vn('n1') + vn('n2');
            let db = JSON.parse(localStorage.getItem('rizqy_rekap')) || [];
            db.push({ u: document.getElementById('userSelect').value, b: document.getElementById('brandSelect').value, i: (document.getElementById('tipeSelect').value === 'HP' ? document.getElementById('namaHP').value : "Aksesoris"), v: total });
            localStorage.setItem('rizqy_rekap', JSON.stringify(db));
            alert("Berhasil!"); renderRekap();
        }

        function renderRekap() {
            const db = JSON.parse(localStorage.getItem('rizqy_rekap')) || [];
            document.getElementById('listRekap').innerHTML = db.map((i, idx) => `<div class="card border-l-4 border-indigo-500 py-2"><button onclick="delRekap(${idx})" class="btn-delete">‚úï</button><p class="text-[9px] font-bold uppercase text-indigo-400">${i.u} | ${i.b}</p><p class="text-[11px] font-bold text-gray-700">${i.i}</p><p class="text-[10px] text-green-600 font-bold">Rp ${f(i.v)}</p></div>`).reverse().join('');
        }
        function delRekap(idx) { if(confirm("Hapus?")) { let db = JSON.parse(localStorage.getItem('rizqy_rekap')); db.splice(idx,1); localStorage.setItem('rizqy_rekap', JSON.stringify(db)); renderRekap(); } }

        function saveOut() {
            let db = JSON.parse(localStorage.getItem('rizqy_out')) || [];
            db.push({ n: document.getElementById('oNm').value, v: vn('oV') });
            localStorage.setItem('rizqy_out', JSON.stringify(db));
            document.getElementById('oNm').value=""; document.getElementById('oV').value=""; renderOut();
        }
        function renderOut() {
            const db = JSON.parse(localStorage.getItem('rizqy_out')) || [];
            document.getElementById('listOut').innerHTML = db.map((i, idx) => `<div class="card border-l-4 border-red-500 py-2"><button onclick="delOut(${idx})" class="btn-delete">‚úï</button><p class="text-[11px] font-bold uppercase text-gray-700">${i.n}</p><p class="text-red-500 font-bold text-xs">Rp ${f(i.v)}</p></div>`).reverse().join('');
        }
        function delOut(idx) { if(confirm("Hapus?")) { let db = JSON.parse(localStorage.getItem('rizqy_out')); db.splice(idx,1); localStorage.setItem('rizqy_out', JSON.stringify(db)); renderOut(); } }

        function manOms() { isManualOms = true; document.getElementById('wOmsBlnView').value = f(vn('wOmsBlnInput')); }

        function calc() {
            document.getElementById('allb-t').value = (dbW.allb || 0) + vn('allb-n');
            [...bCf,...oCf].forEach(c => document.getElementById(c.id+'-t').value = (dbW[c.id]||0) + vn(c.id+'-n'));
            document.getElementById('aks-t').value = (dbW.aks||0) + vn('aks-n');
            document.getElementById('wi-t').value = (dbW.wi||0) + vn('wi-n');
            document.getElementById('tr-p').value = vn('wi-n') > 0 ? Math.round((vn('tr-n')/vn('wi-n'))*100)+"%" : "0%";
            let debTotal = vn('wBca') + vn('wAdm');
            document.getElementById('vDeb').innerText = "Total Debit: Rp " + f(debTotal);
            if(!isManualOms) {
                const totalOms = (dbW.oms || 0) + vn('wOms');
                document.getElementById('wOmsBlnInput').value = totalOms;
                document.getElementById('wOmsBlnView').value = f(totalOms);
            }
            let outVal = (JSON.parse(localStorage.getItem('rizqy_out'))||[]).reduce((a,b)=>a+b.v, 0);
            let tunai = vn('wOms') - debTotal;
            document.getElementById('wTunai').value = f(tunai);
            document.getElementById('wOut').value = f(outVal);
            document.getElementById('wSisa').value = f(tunai - outVal);
        }

        function initReport() {
            document.getElementById('wTgl').value = new Date().toISOString().slice(0,10);
            document.getElementById('brandList').innerHTML = bCf.map(b => `<div class="grid-report"><div class="text-xs font-bold text-gray-500">${b.n}</div><input type="number" id="${b.id}-n" class="input-box mb-0 p-1" oninput="calc()"><input type="number" id="${b.id}-t" class="input-box mb-0 p-1 bg-gray-50 font-bold" value="${dbW[b.id]||0}" readonly><div class="text-[10px] text-orange-500 font-bold text-center">${b.t}</div></div>`).join('');
            document.getElementById('otherList').innerHTML = oCf.map(o => `<div class="grid-report"><div class="text-xs font-bold text-gray-500">${o.n}</div><input type="number" id="${o.id}-n" class="input-box mb-0 p-1" oninput="calc()"><input type="number" id="${o.id}-t" class="input-box mb-0 p-1 bg-gray-50 font-bold" value="${dbW[o.id]||0}" readonly><div></div></div>`).join('');
            document.getElementById('allb-t').value = dbW.allb || 0;
            document.getElementById('wOmsBlnInput').value = dbW.oms || 0;
            document.getElementById('wOmsBlnView').value = f(dbW.oms || 0);
        }

        function preview() {
            const v = (id) => document.getElementById(id).value || "0";
            let s = `Sell out toko GKB ${new Date(v('wTgl')).toLocaleDateString('id-ID',{day:'numeric',month:'long',year:'numeric'})}\n\nFokuskan brand\n`;
            bCf.forEach((b,x) => { s += `${b.n} : ${v(b.id+'-n')}.${v(b.id+'-t')}.${b.t} (${Math.round((v(b.id+'-t')/b.t)*100)||0}%)\n`; if(x===2) s+="\n"; });
            s += `Nokia : ${v('nk-n')}.${v('nk-t')}\n\nOther : ${v('ot-n')}.${v('ot-t')}\nHP Second & Demo : ${v('sc-n')}.${v('sc-t')}\n\nSepeda : ${v('sp-n')}.${v('sp-t')}\n`;
            s += `Aksesoris : ${v('aks-n')}.${v('aks-t')}\nAll Brand : ${v('allb-n')}.${v('allb-t')}\n\nWalk in : ${v('wi-n')}(${v('wi-t')})\nTransaksi : ${v('tr-n')}(${v('tr-p')})\n\n`;
            let debTotal = vn('wBca') + vn('wAdm');
            let tunai = vn('wOms') - debTotal;
            let outVal = (JSON.parse(localStorage.getItem('rizqy_out'))||[]).reduce((a,b)=>a+b.v, 0);
            s += `*tunai : ${f(tunai)}\n\n*debit : ${f(debTotal)}\n- bca ${f(vn('wBca'))}\n- bca admin ${f(vn('wAdm'))}\n\n*pengeluaran : ${f(outVal)}\n*sisa tunai : ${f(tunai-outVal)}\n\nPencapaian omset : ${f(vn('wOmsBlnInput'))}`;
            document.getElementById('previewBox').innerText = s; document.getElementById('previewBox').classList.remove('hidden');
        }

        function copyText() { navigator.clipboard.writeText(document.getElementById('previewBox').innerText).then(()=>alert("Copied!")); }
        
        function resetData(type) { 
            if(confirm(type === 'hari' ? "Reset Harian?" : "RESET TOTAL SEBULAN?")) { 
                if(type === 'hari') {
                    [...bCf,...oCf,{id:'aks'},{id:'wi'},{id:'allb'}].forEach(c => { const id = c.id || c; dbW[id] = vn(id+'-t'); });
                    dbW.oms = vn('wOmsBlnInput');
                } else {
                    [...bCf,...oCf,{id:'aks'},{id:'wi'},{id:'allb'}].forEach(c => { const id = c.id || c; dbW[id] = 0; });
                    dbW.oms = 0;
                }
                localStorage.setItem('rizqy_save', JSON.stringify(dbW)); 
                localStorage.removeItem('rizqy_out'); 
                localStorage.removeItem('rizqy_rekap'); 
                location.reload(); 
            } 
        }

        window.onload = () => { renderRekap(); renderOut(); initReport(); };
    </script>
</body>
</html>
